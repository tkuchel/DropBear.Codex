@using DropBear.Codex.Blazor.Enums
@using DropBear.Codex.Blazor.Helpers
@inherits DropBear.Codex.Blazor.Components.Bases.DropBearComponentBase

@* SECURITY NOTE: Message content is sanitized using HtmlSanitizationHelper to prevent XSS attacks.
   If you need to display trusted HTML from CMS/admin, use HtmlSanitizationHelper.FromTrustedSource() instead. *@

<div id="@AlertId"
     class="alert @AlertTypeCssClass @(_isVisible ? "alert--visible" : "alert--hidden")"
     role="alert"
     aria-live="@(_type == PageAlertType.Error ? "assertive" : "polite")"
     aria-atomic="true"
     @onanimationend="OnAnimationEnd">

    <div class="alert__content">
        <div class="alert__header">
            <div class="alert__icon" aria-hidden="true">
                @GetIcon()
            </div>
            @if (!string.IsNullOrWhiteSpace(Title))
            {
                <h3 class="alert__title">@Title</h3>
            }
        </div>

        @if (!string.IsNullOrWhiteSpace(Message))
        {
            <div class="alert__message">
                @* SECURITY: Sanitize alert message to prevent XSS attacks *@
                @HtmlSanitizationHelper.Sanitize(Message)
            </div>
        }
    </div>

    @if (!IsPermanent)
    {
        <div class="alert__progress"
             style="--progress: @(_progressPercentage)%"
             aria-hidden="true"></div>

        <button type="button"
                class="alert__close"
                aria-label="Close alert"
                @onclick="HandleCloseClick"
                @onclick:preventDefault="true">
            <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
    }
</div>
